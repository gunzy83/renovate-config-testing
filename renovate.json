{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":semanticCommitTypeAll(chore)"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "datasourceTemplate": "helm",
      "description": "Manage helm release versions in Pulumi config",
      "managerFilePatterns": [
        "/.*/Pulumi(\\.|\\.[a-z0-9-]*)yaml/"
      ],
      "matchStrings": [
        ".*: [\"']?(?<currentValue>[^'\" ]+)[\"']? +# renovate\\(helm\\): depName=(?<depName>[^ \\n]+) registryUrl=(?<registryUrl>[^ \\n]+)"
      ],
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "datasourceTemplate": "docker",
      "depTypeTemplate": "helm-oci",
      "description": "Manage helm-oci release versions in Pulumi config",
      "managerFilePatterns": [
        "/.*/Pulumi(\\.|\\.[a-z0-9-]*)yaml/"
      ],
      "matchStrings": [
        ".*: [\"']?(?<currentValue>[^'\" ]+)[\"']? +# renovate\\(helm-oci\\): depName=(?<depName>[^ \\n]+) packageName=oci://(?<packageName>[^ \\n]+)"
      ],
      "versioningTemplate": "helm"
    },
    {
      "customType": "regex",
      "datasourceTemplate": "docker",
      "description": "Manage docker image tags in Pulumi config",
      "managerFilePatterns": [
        "/.*/Pulumi(\\.|\\.[a-z0-9-]*)yaml/"
      ],
      "matchStrings": [
        ".*: [\"']?(?<currentValue>[^'\" ]+)[\"']? +# renovate\\(docker\\): depName=(?<depName>[a-z./-]+) registryUrl=(?<registryUrl>[a-z.]+)"
      ],
      "registryUrlTemplate": "https://{{registryUrl}}"
    },
    {
      "customType": "regex",
      "description": "Generic dependency bumping with inline datasource selection in Pulumi config",
      "managerFilePatterns": [
        "/.*/Pulumi(\\.|\\.[a-z0-9-]*)yaml/"
      ],
      "matchStrings": [
        ".*: [\"']?(?<currentValue>[^'\" ]+)[\"']? +# renovate: datasource=(?<datasource>[a-z-.]+?) depName=(?<depName>[^ \\n]+)"
      ]
    },
    {
      "customType": "regex",
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "teleport-ent",
      "depTypeTemplate": "asdf-custom",
      "description": "Manage teleport-ent asdf versions",
      "extractVersionTemplate": "^v(?<version>.+)$",
      "packageNameTemplate": "gravitational/teleport",
      "managerFilePatterns": [
        "/\\.tool-versions$/"
      ],
      "matchStrings": [
        "(^|\\n)teleport-ent +(?<currentValue>\\S+)"
      ]
    },
    {
      "customType": "regex",
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "jq",
      "depTypeTemplate": "asdf-custom",
      "description": "Manage jq asdf versions",
      "extractVersionTemplate": "^jq-(?<version>.+)$",
      "packageNameTemplate": "jqlang/jq",
      "managerFilePatterns": [
        "/\\.tool-versions$/"
      ],
      "matchStrings": [
        "(^|\\n)jq +(?<currentValue>\\S+)"
      ]
    }
  ],
  "enabledManagers": [
    "asdf",
    "custom.regex",
    "npm"
  ],
  "labels": [
    "dependencies"
  ],
  "packageRules": [
    {
      "matchDepTypes": [
        "dependencies"
      ],
      "description": "Only major version updated will be marked as fix",
      "major": {
        "semanticCommitType": "fix"
      }
    },
    {
      "matchDatasources": [
        "helm",
        "docker"
      ],
      "description": "Weekly updates for helm and docker dependencies",
      "schedule": [
        "* * * * 0,6"
      ]
    },
    {
      "matchDepTypes": [
        "helm-oci"
      ],
      "commitMessageTopic": "helm release {{depName}}",
      "description": "Weekly updates for helm-oci dependencies",
      "schedule": [
        "* * * * 0,6"
      ]
    },
    {
      "matchDatasources": [
        "npm"
      ],
      "commitMessageTopic": "npm package {{depName}}",
      "description": "Monthly updates for npm dependencies",
      "schedule": [
        "* * 5 * *"
      ]
    },
    {
      "matchDatasources": [
        "npm"
      ],
      "matchDepTypes": [
        "devDependencies",
        "dev-dependencies",
        "dev"
      ],
      "description": "Group npm dev dependencies",
      "groupName": "npm dev dependencies"
    },
    {
      "matchDatasources": [
        "npm"
      ],
      "matchDepTypes": [
        "dependencies"
      ],
      "description": "Group npm dependencies, some may be grouped separately in later rules",
      "groupName": "ungrouped npm dependencies",
      "rangeStrategy": "pin"
    },
    {
      "matchManagers": [
        "asdf"
      ],
      "commitMessageTopic": "asdf version for {{depName}}",
      "description": "Monthly updates for asdf dependencies",
      "groupName": "ungrouped asdf dependencies",
      "schedule": [
        "* * 5 * *"
      ]
    },
    {
      "matchDepTypes": [
        "asdf-custom"
      ],
      "commitMessageTopic": "asdf version for {{packageName}}",
      "description": "Monthly updates for custom managed asdf dependencies",
      "groupName": "ungrouped asdf dependencies",
      "schedule": [
        "* * 5 * *"
      ]
    },
    {
      "matchPackageNames": [
        "/^node$/",
        "/^@types/node$/"
      ],
      "description": "Group nodejs runtime and the @types/node package",
      "groupName": "nodejs"
    },
    {
      "matchPackageNames": [
        "/teleport/",
        "/tbot/"
      ],
      "groupName": "teleport",
      "description": "Weekly updates for teleport dependencies",
      "schedule": [
        "* * * * 0,6"
      ]
    },
    {
      "groupName": "pulumi packages",
      "description": "Group pulumi packages",
      "matchPackageNames": [
        "/^@pulumi//",
        "/pulumi/"
      ]
    },
    {
      "matchDepNames": [
        "lts/squid"
      ],
      "description": "Custom versioning pattern for squid container image",
      "versioning": "regex:^(?<major>\\d+)\\.(?<minor>\\d+)-.*$"
    },
    {
      "matchDatasources": [
        "github-releases"
      ],
      "matchDepNames": [
        "bottlerocket-os/bottlerocket"
      ],
      "commitMessageTopic": "Bottlerocket OS release",
      "description": "Set commit message topic for bottlerocket"
    },
    {
      "matchDatasources": "helm",
      "matchPackageNames": "metrics-server",
      "description": "Point renovate to the changelog for metrics-server",
      "sourceDirectory": "charts/metrics-server",
      "sourceUrl": "https://github.com/kubernetes-sigs/metrics-server"
    },
    {
      "matchDatasources": "helm",
      "matchPackageNames": "kube-prometheus-stack",
      "changelogUrl": "https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/README.md",
      "description": "Point renovate to the changelog for kube-prometheus-stack and raise multiple major PRs",
      "separateMultipleMajor": true
    },
    {
      "matchDatasources": "helm",
      "matchDepNames": [
        "traefik"
      ],
      "description": "Point renovate to the changelog for traefik and raise multiple major PRs",
      "separateMultipleMajor": true,
      "sourceDirectory": "traefik",
      "sourceUrl": "https://github.com/traefik/traefik-helm-chart"
    },
    {
      "matchDatasources": "helm",
      "matchDepNames": [
        "external-dns"
      ],
      "description": "Point renovate to the changelog for external-dns",
      "sourceDirectory": "charts/external-dns",
      "sourceUrl": "https://github.com/kubernetes-sigs/external-dns"
    },
    {
      "matchDepNames": [
        "teleport-kube-agent",
        "teleport-plugin-event-handler",
        "gravitational/tbot-distroless"
      ],
      "allowedVersions": "/^[1-9][0-9]*\\.[1-9][0-9]*\\.[0-9]+$/",
      "description": "Disallow dev versions and point to the changelog for teleport dependencies",
      "sourceUrl": "https://github.com/gravitational/teleport"
    },
    {
      "matchDatasources": "helm",
      "matchDepNames": [
        "datadog-operator"
      ],
      "description": "Point renovate to the changelog for datadog-operator",
      "sourceDirectory": "charts/datadog-operator",
      "sourceUrl": "https://github.com/DataDog/helm-charts"
    },
    {
      "matchDepNames": [
        "gravitational/teleport"
      ],
      "matchManagers": [
        "custom.regex"
      ],
      "allowedVersions": "/^[1-9][0-9]*\\.[1-9][0-9]*\\.[0-9]+$/",
      "commitMessageTopic": "asdf version for {{depName}}",
      "description": "Disallow dev versions and point to the changelog for teleport-ent asdf"
    },
    {
      "matchPackageNames": [
        "kubectl"
      ],
      "description": "Exclude major and minor updates for kubectl, it will be updated with the clusters",
      "excludeUpdateTypes": [
        "major",
        "minor"
      ]
    }
  ],
  "semanticCommits": "enabled",
  "rebaseWhen": "conflicted",
  "timezone": "Australia/Brisbane"
}
